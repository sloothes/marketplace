<!DOCTYPE html>
<html>
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="">

    <title>Background market</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/anywhere3d.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/photoswipe.css">
    <link rel="stylesheet" href="/css/photoswipe/default-skin.css">
	<link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.5/default/snipcart.css" />

    <script>debugMode = true;</script>
    <script src="/socketcluster.js"></script>
    <script src="/sc-codec-min-bin.js"></script>
    <script src="/js/photoswipe.js"></script>
    <script src="/js/photoswipe-ui-default.js"></script>


</head>

<body>

<style>

    body {
        overflow:auto;
    }

    .well { 
        background:none; 
    }

    .well.product-card { 
    /*  vertical-align:middle !important;  */
        color: #fff;
        display:inline-block; 
        height:360px; 
        width:235px;
		margin:10px;
    }

    .card-field-price {
        font-size:3rem;
        font-weight:bold;
        font-family:sans-serif;
        text-align:center;
    }

    .card-field-title {
        color:#ccc;
        max-width:100%;
        font-size:2rem;
        font-weight:normal;
        font-family:sans-serif;
        text-overflow:ellipsis;
        text-align:center;
    }

    #catalogue-section {
        overflow:auto;
        background-color:#000;
    }

    #products-display {
        border:none;
        height:700px;
        min-width:320px;
		max-width: 1600px;
        min-height:438px;
        max-height:705px;
        text-align:center;
        overflow:auto;
    }

	.product-img {
		max-width:100%;
		height:auto;
		margin:10px auto;
	}

	.product-title {
		color:#fff;
		font-size:1.5em;
		font-weight:bold;
		max-width:100%;
		max-height:2em;
		margin:0 auto 10px auto;
		overflow:hidden;
	}

	.product-price {
		color:#fff;
		font-size:2em;
		font-weight:bold;
		max-width:100%;
		max-height:3em;
		margin:0 auto 10px auto;
	}

    @media all and ( max-width: 640px ) {

        .well.product-card { 
            display:inline-block; 
            height:65%; 
            width:100%;
        }

        #products-display {
            max-height: 300px;
        }
    }

    /*  photoswipe  */

    .viewer {
        width:750px;
        height:750px;
        max-width:90%;
        max-height:90%;
        background:#ffffff33;
    }

    /*  snipcart  */

    .snipcart-add-item {
        color:#fff;
        width:80%;
        font-size:2rem;
        padding:6px 14px;
        border:1px solid #ddd;
        border-radius:20px !important;
        background-color:#42bcf9;
    }
	
	a.snipcart-add-item {
		cursor:pointer;
		text-decoration:none;
		background-color:#42bcf9 !important;
	}


</style>

<section class="mbr-section" id="catalogue-section">

<div id="products-catalogue-panel" class="tab-content" style="width:100%;">

    <div id="catalogue-items-panel" class="well" style="width:100%;margin:0;">

        <h4 style="color:#fff;"><a href="/marketplace">market&nbsp;/</a>&nbsp;backgrounds:
            <div id="counter-top-right" class="pull-right small items-counter" style="margin-top:4px;color:#ddd;">
                items <span class="from">-</span>
                to <span class="upto">-</span>
                of <span class="count">null</span>
            </div>
        </h4>

        <div id="products-catalogue-pager" class="pager">
            <div style="margin:10px auto 10px auto;height:35px;max-width:400px;">
                <li class="btn btn-primary get-prev-btn pull-left">&#9668;</li>
                <div class="pager-buttons-holder" style="display:inline;">
                    <a class="btn btn-default page-btn">1</a>
                    <a class="btn btn-default page-btn">2</a>
                    <a class="btn btn-default page-btn">3</a>
                    <a class="btn btn-default page-btn">4</a>
                </div>
                <li class="btn btn-primary get-next-btn pull-right">&#9658;</li>
            </div>

            <div id="products-display" class="well">
			<!--
				<a class="snipcart-add-item"
				   data-item-id="BGD458-648-006" 
				   data-item-name="001" 
				   data-item-price="0.45" 
				   data-item-image="https://i.imgur.com/ivqfmOft.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-649-006" 
				   data-item-name="autumn" 
				   data-item-price="0.23" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-650-006" 
				   data-item-name="darksea" 
				   data-item-price="0.64" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-651-006" 
				   data-item-name="dawnmountain" 
				   data-item-price="0.35" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-652-006" 
				   data-item-name="forest" 
				   data-item-price="0.35" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-654-006" 
				   data-item-name="garage" 
				   data-item-price="0.40" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-655-006" 
				   data-item-name="island-road" 
				   data-item-price="0.50" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-655-006" 
				   data-item-name="mebula" 
				   data-item-price="0.42" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-656-006" 
				   data-item-name="moondust" 
				   data-item-price="0.38" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="https://sloothes.com/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-657-006" 
				   data-item-name="pines-road" 
				   data-item-price="0.74" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>

				<a class="snipcart-add-item"
				   data-item-id="BGD458-658-006" 
				   data-item-name="road" 
				   data-item-price="0.33" 
				   data-item-image="https://i.imgur.com/beAmx5ut.png"
				   data-item-url="/marketplace/backgrounds">
					Add to cart
				</a>
			-->
			</div>

            <div style="margin:10px auto 10px auto;height:35px;max-width:400px;">
                <li class="btn btn-primary btn-white-outline first-page-btn pull-left" style="margin-right:5px;">First</li>
                <li class="btn btn-primary btn-white-outline get-prev-group-btn pull-left">&#9668;&#9668;</li>
                <div id="counter-bottom-center" class="items-counter" style="width:fit-content;display:inline;height:35px;margin-top:4px;color:#ddd;">
                    items <span class="from">-</span> to <span class="upto">-</span> of <span class="count">null</span>
                </div>
                <li class="btn btn-primary btn-white-outline last-page-btn pull-right" style="margin-left:5px;">Last</li>
                <li class="btn btn-primary btn-white-outline get-next-group-btn pull-right">&#9658;&#9658;</li>
            </div>
        </div>

    </div>

</div>

    <!-- PHOTOSWIPE -->

<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>
    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>

</section>

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery-ui.js"></script>
<script src="/js/rawinflate.js"></script>
<script src="/js/rawdeflate.js"></script>
<script src="/js/Objectid.js"></script>
<script src="/js/zangodb.min.js"></script>
<script src="/js/bootbox.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/DeviceDetector.js"></script>
<script src="/js/MathDecimalAdjustment.js"></script>
<script src="/js/watermark.js"></script>
<script src="/js/system.min.js"></script>
<script src="/js/signals.min.js"></script>
<script src="/js/validator.min.js"></script>

<script src="js/app.js"></script>
<script src="/three/three.js"></script>
<script src="/three/EditorControls.js"></script> 

<script>

//	Loader.
/*
	var manager = new THREE.LoadingManager();
	var loader = new THREE.XHRLoader( manager );
	loader.load( "demo.json", function ( text ) {

		var json = JSON.parse( text );

		app = new APP.Player();

		app.load( json );

	});
*/
</script>

<!--	PRODUCTS	-->


<div style="display:none;"></div>


<script>

//  Socketcluster.

	socket = socketCluster.create({
		hostname: "anywhere3d.com",
		codecEngine: scCodecMinBin,
	});

	socket.on("connect", function(status){
		debugMode && console.log({"status": status});
	});

	socket.on("error", function (err) {
		console.error( err.stack );
	});

	socket.on("authStateChange", function( state ){
		debugMode && console.log({"authStateChange": state});
	});

	socket.on("subscribe", function( name, object ){
		debugMode && console.log("subscribed successfully to", name, "channel:", object);
	});

</script>

<script>

	const pagebuttons = document.getElementsByClassName("page-btn");
	const displayObjects = document.getElementById("products-display");

	const prevPageBtn  = document.getElementsByClassName("get-prev-btn").item(0);
	const nextPageBtn  = document.getElementsByClassName("get-next-btn").item(0);
	const lastPageBtn  = document.getElementsByClassName("last-page-btn").item(0);
	const firstPageBtn = document.getElementsByClassName("first-page-btn").item(0);
	const prevGroupBtn = document.getElementsByClassName("get-prev-group-btn").item(0);
	const nextGroupBtn = document.getElementsByClassName("get-next-group-btn").item(0);

	var timeout;
	var interval;
	var selectors;
	var delay = 250;

	var limit = 12;
	var currency = "$"; // important!

	var max = 0;
	var skip = 0;
	var lastpage = 0;
	var currentpage = 0;
	var currentindex = 0;

	const collection = "skyboxes";

	socket.on("connect", function(status){

		count();

	//  Page buttons init.
		for ( var i = 0; i < pagebuttons.length; i++) {
			pagebuttons.item(i).skip = limit * i;
			pagebuttons.item(i).text = i + 1; // ( because is <a> and have text property )
			pagebuttons.item(i).classList.remove("btn-primary");
		}

	//  Current button setup.
		pagebuttons.item(0).classList.add("btn-primary");

	//  Clear listed objects.
		while( displayObjects.children.length ) {
			displayObjects.children.item(0).remove();
		}

		getItems();

	});

	function count(){

		var data =  {
			selectors: {},
			collection: collection,
			options: {},
		};

		var counters = document.getElementsByClassName("count");

		socket.emit("mongo count", data, function(err, num){
			max = num; // important!
			debugMode && console.log("max:", max);
			for ( var i = 0; i < counters.length; i++ ) {
				counters.item(i).textContent = max;
			}
		});

	}

	function reset(){

		max = 0;
		skip = 0;
		lastpage = 0;
		currentpage = 0;
		currentindex = 0;

	}

	function getItems(){

		var data = {
			selectors: {},
			collection: collection,
			options: { 
				skip:skip, limit:limit, 
				fields:{ ext:1, posx:1, title:1, value:1, product_id:1 } 
			}
		};

		socket.emit("mongo find", data, function(err, docs){
			debugMode && console.log("docs:", docs);

			if ( !docs.length ) return;

			while( displayObjects.children.length ) {
				displayObjects.children.item(0).remove(); // important!
			}

			docs.forEach(function(doc, index){

				var card = document.createElement("li");
				card.id = doc._id; // card.data = doc; // optional!
				card.classList.add("well", "product-card");
				card.style.cssText = "vertical-align:middle!important;";

				var loader = new THREE.ImageLoader();
				var url = "https://i.imgur.com/"+doc.posx+"t."+doc.ext;
				var img = loader.load( url, function( img ){
					img.classList.add("thumbnail");
				});
				img.classList.add("product-img");
			//	img.style.cssText = "max-width:100%;height:auto;margin:0 auto 10px auto;";
				card.appendChild(img);
				

				var title = document.createElement("div");
				title.classList.add("product-title");
			//	title.style.cssText = "color:#fff;font-size:1.5em;font-weight:bold;max-width:100%;max-height:2em;margin:0 auto 10px auto;overflow:hidden;";
				title.textContent = doc.title;
				card.appendChild(title);

				var price = document.createElement("div");
				price.classList.add("product-price");
			//	price.style.cssText = "color:#fff;font-size:2em;font-weight:bold;max-width:100%;max-height:3em;margin:0 auto 10px auto;";
				price.textContent = doc.value;
				card.appendChild(price);

			//	<a class="snipcart-add-item"
			//	   data-item-id="BGD458-656-006" 
			//	   data-item-name="moondust" 
			//	   data-item-price="0.38" 
			//	   data-item-image="https://i.imgur.com/beAmx5ut.png"
			//	   data-item-url="https://sloothes.com/marketplace/backgrounds">
			//		Add to cart
			//	</a>

				var button = document.createElement("a");
				button.text = "Add to cart";
				button.classList.add( "snipcart-add-item" );
				button.setAttribute("data-item-name", doc.title);
				button.setAttribute("data-item-price", doc.value);
				button.setAttribute("data-item-id", doc.product_id);
				button.setAttribute("data-item-image", "https://i.imgur.com/"+doc.posx+"t."+doc.ext);
				button.setAttribute("data-item-url", "/marketplace/backgrounds");
				card.appendChild(button);

				displayObjects.appendChild(card);

			});

		//  Display count info.

			var spans = document.getElementsByClassName("from");
			for ( var i = 0; i < spans.length; i++ ) {
				if ( max == 0 ) spans.item(i).textContent = "-";
				else if ( skip == max ) spans.item(i).textContent = skip;
				else spans.item(i).textContent = skip + 1;
			}

			var spans = document.getElementsByClassName("upto");
			for ( var i = 0; i < spans.length; i++ ) {
				if ( max == 0 ) spans.item(i).textContent = "-";
				else if ( skip == max ) spans.item(i).textContent = max;
				else spans.item(i).textContent = skip + docs.length;
			}

			var spans = document.getElementsByClassName("count");
			for ( var i = 0; i < spans.length; i++ ) {
				spans.item(i).textContent = max;
			}

		});

	}


	function pagerClicked(){

		clearTimeout(interval);

		var pageslength = pagebuttons.length;

	//  Get last page.
		lastpage = parseInt( max / limit );

	//  Get current page.
		currentpage = parseInt( skip / limit );

	//  Get current index.
		currentindex = parseInt( currentpage % pageslength );

		debugMode && console.log({"max":max, "skip":skip, "index": currentindex});

	//  Page buttons numbering.

		var num = parseInt( currentpage / pageslength ) * pageslength;

		for( var i= 0; i < pagebuttons.length; i++) {
			var page = num + i;
			pagebuttons.item(i).skip = limit * page; // important!
			pagebuttons.item(i).text = page + 1; // important! ( because is <a> and have text property )
			pagebuttons.item(i).classList.remove("btn-primary");
		}

	//  Current button.

		pagebuttons.item( currentindex ).classList.add("btn-primary");

	//	Get items.

		if ( max && skip < max ) {
			interval = setTimeout( getItems, delay );
		}

	}


	//  Pager.

	//  For performance we count items only when we ask last page 
	//  or we change droplist selectors. Not need to count on backward.

	//  Page button.

	for ( var i = 0; i < pagebuttons.length; i++ ) {

		pagebuttons.item(i).addEventListener("click", function(){

			if ( max && this.skip < max ) {
				skip = this.skip;
				pagerClicked();
			}

			debugMode && console.dir( this );

		});

	}

	//  First page.

	firstPageBtn.addEventListener("click", function(){

		skip = 0;
		pagerClicked();

	});

	//  Last page.

	lastPageBtn.addEventListener("click", function(){

		if ( max && max > 0 ) {

			var lastpage = parseInt( max / limit );

			if ( limit * lastpage < max ) {

				skip = limit * lastpage;          //  limit * parseInt(max / limit);

			} else {

				skip = limit * ( lastpage - 1 );  //  limit * ( parseInt(max / limit) - 1 );

			}

		} else {

			skip = 0;

		}

		pagerClicked();

	//  Update count. (optional)

		count();

	});

	//  Prev page.

	$(prevPageBtn).on("click", function(){

		if ( skip - limit < 0 ) {

			skip = 0;

		} else {

			skip -= limit;
		}

		pagerClicked();

	});

	//  Next page.

	nextPageBtn.addEventListener("click", function(){

		var lastpage = parseInt( max / limit );

		if ( skip + limit < max )

			skip += limit;

		else if ( skip + limit > max )

			skip = limit * lastpage;

		//  else if ( skip + limit == max ) skip;

		pagerClicked();

	});

	//  Prev group.

	prevGroupBtn.addEventListener("click", function(){

		var offset = pagebuttons.length * limit;

		if ( skip - offset < 0 ) {

			skip = 0;

		} else {

			skip -= offset;
		}

		pagerClicked();

	});

	//  Next group.

	nextGroupBtn.addEventListener("click", function(){

		var offset = pagebuttons.length * limit;

		if ( max > 0 ) {

			var lastpage = parseInt( max / limit );

			if ( skip + offset < max ) {

				skip += offset;

			} else if ( skip + offset > max ) {

				if ( limit * lastpage < max ) {

					skip = limit * lastpage;

				} else {

					skip = limit * ( lastpage - 1 );
				}

			} else if ( skip + offset == max ) {

				skip = limit * ( lastpage - 1 );

			}

		} else {

			skip = 0;

		}

		pagerClicked();

	});

</script>

<div hidden id="snipcart" data-api-key="MGY1ZGNjMWItZTk5NS00ZTFjLWExMGMtOWVlNjQxM2I2ZmYwNjM3MDI1NTA1ODY4NDc4NTkw"></div>
<script src="https://cdn.snipcart.com/themes/v3.0.5/default/snipcart.js"></script>

</body>
</html>
